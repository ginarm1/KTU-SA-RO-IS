@model KTU_SA_RO.Models.Event

@{
    ViewData["Title"] = "Renginio detali informacija";
    var positions = ViewData["positions"] as List<string>;
    var eventTeam = ViewData["eventTeam"] as Dictionary<int, ApplicationUser>;
    var membersRole = ViewData["membersRole"] as Dictionary<int, string>;
}

<div class="container display-5 my-4 fw-bold">Plačiau apie renginį</div>

@if (TempData["success"] != null)
{
    <div class="alert alert-success mt-4" role="alert">
        @Html.Raw(TempData["success"].ToString())
    </div>
}

<div>
    <hr />
    <div class="container row">
        <div class="col-lg-6" style="border-right:1px solid #E1E1E1;">
            <h5 class="display-6 mb-4">
                Pagrindinė info
            </h5>
            <div class="container">
                <div class="row">
                    <div class="col-sm-3 col-lg-4 mb-3 fw-bold">
                        @Html.DisplayNameFor(model => model.Title)
                    </div>
                    <div class="col-sm-9 col-lg-8 fw-bold">
                        @Html.DisplayFor(model => model.Title)
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3 col-lg-4 mb-3 fw-bold">
                        Renginio data
                    </div>
                    <div class="col-sm-9 col-lg-8">
                        @Html.DisplayFor(model => model.StartDate) - @Html.DisplayFor(model => model.EndDate)
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3 col-lg-4 mb-3 fw-bold">
                        @Html.DisplayNameFor(model => model.Location)
                    </div>
                    <div class="col-sm-9 col-lg-8">
                        @if (Model.Location == null)
                        {
                            <span>-</span>
                        }
                        else
                        {
                            @Html.DisplayFor(model => model.Location)
                        }
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3 col-lg-4 mb-5 fw-bold">
                        @Html.DisplayNameFor(model => model.Description)
                    </div>
                    <div class="col-sm-9 col-lg-8">
                        @Html.DisplayFor(model => model.Description)
                    </div>
                </div>
            </div>

        </div>
        <div class="col-lg-6">
            @if (TempData["danger"] != null)
            {
                <div class="alert alert-danger mt-4" role="alert">
                    @Html.Raw(TempData["danger"].ToString())
                </div>
            }
            <div class="d-flex justify-content-between">
                <h5 class="display-6 mb-4">
                    Renginio komanda
                </h5>
                <div class="btn btn-primary mt-3 mb-4 col-sm-5 col-lg-3 rounded-2" id="addUserBtn"><i class="fas fa-plus-circle pt-1 pe-1" style="font-size: 20px"></i> Pridėti narį</div>
            </div>
            @*Add user to an event team*@

            <div class="row" id="containerAddUser">
                <form asp-action="Create" asp-controller="EventTeamMembers">
                    <input name="eventId" class="form-control" value="@Model.Id" hidden />
                    <div class="d-flex justify-content-between">
                        <input name="userName" class="form-control me-3" placeholder="Vardas" required />
                        <input name="userSurname" class="form-control" placeholder="Pavardė" required />
                    </div>
                    <div class="d-flex justify-content-between my-4">
                        <input name="userEmail" class="form-control w-50" type="email" placeholder="El. paštas (neprivaloma)" />
                        <div class="form-label mt-1">Pozicija:</div>
                        <select name="pickedPosition" class="form-control w-25" asp-items="@(new SelectList(positions,"",""))" required>
                            <option value=""></option>
                        </select>
                    </div>
                    <input type="submit" value="Patvirtinti" class="btn btn-primary text-uppercase float-end mb-4 rounded-2" id="submit" />
                </form>
            </div>
            @******@
            @if (eventTeam != null)
            {
                for (int i = 0; i < eventTeam.Count(); i++)
                {
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between">
                            <div class="fw-bold">@eventTeam.ElementAt(i).Value.Name @eventTeam.ElementAt(i).Value.Surname</div>
                            <div class="me-1 px-2 rounded-3 text-white fw-light bg-dark">@eventTeam.ElementAt(i).Value.Email</div>
                        </div>
                        <div class="row my-3 mx-2 ">
                            <div class="col-8" >@membersRole.ElementAt(i).Value</div>
                            <div class="col-4 align-items-end">
                                <!-- Button trigger modal -->
                                <button type="button" class="btn btn-outline-dark rounded-2" data-toggle="modal" data-target="#exampleModal-@eventTeam.ElementAt(i).Key">
                                  <i class="fas fa-trash pe-1"></i> Ištrinti
                                </button>

                                <!-- Modal -->
                                <div class="modal fade" id="exampleModal-@eventTeam.ElementAt(i).Key" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                  <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Ar tikrai norite pašalinti?</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                        </button>
                                      </div>
                                      <div class="modal-body">
                                        Pašalinsite <b>@eventTeam.ElementAt(i).Value.Name @eventTeam.ElementAt(i).Value.Surname</b> iš komandos
                                      </div>
                                      <div class="modal-footer">
                                        @*<button type="button" class="btn btn-secondary" data-dismiss="modal">Uždaryti</button>*@
                                        <form asp-action="Delete">
                                            <input type="submit" asp-action="Delete" asp-controller="EventTeamMembers" asp-route-id="@eventTeam.ElementAt(i).Key"  value="Patvirtinti" class="btn btn-danger rounded-2 text-uppercase" />
                                        </form>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <!----->
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="alert alert-danger mt-4" role="alert">
                    Komadoje narių nerasta
                </div>
            }
        </div>
        <div><hr /></div>
        <div class="col-sm-3 col-lg-2 mb-3">
            @Html.DisplayNameFor(model => model.Has_coordinator)
        </div>
        <div class="col-sm-8 col-lg-2" style="border-right:1px solid #E1E1E1;">
            @if (!Model.Has_coordinator)
            {
                <span><i class="fas fa-times"></i></span>
            }
            else
            {
                <i class="fas fa-check"></i>
            }
        </div>
        <div class="col-sm-3 col-lg-2 mb-3">
            Renginio koordinatorius
        </div>
        <div class="col-sm-9 col-lg-2" style="border-right:1px solid #E1E1E1;">
            @Html.DisplayFor(model => model.CoordinatorName) <span class="ms-2">@Html.DisplayFor(model => model.CoordinatorSurname)</span>
        </div>

        <div class="col-sm-3 col-lg-2 mb-2">
            @Html.DisplayNameFor(model => model.Is_canceled)
        </div>
        <div class="col-sm-9 col-lg-1">
            @if (!Model.Is_canceled)
            {
                <span><i class="fas fa-times"></i></span>
            }
            else
            {
                <span><i class="fas fa-check"></i></span>
            }
        </div>
        <div class="my-3"></div>
        <div class="col-sm-3 col-lg-2 mb-3">
            @Html.DisplayNameFor(model => model.Is_live)
        </div>
        <div class="col-sm-9 col-lg-2" style="border-right:1px solid #E1E1E1;">
            @if (!Model.Is_live)
            {
                <span><i class="fas fa-times"></i></span>
            }
            else
            {
                <i class="fas fa-check"></i>
            }
        </div>
        <div class="col-sm-3 col-lg-2 mb-3">
            @Html.DisplayNameFor(model => model.PlannedPeopleCount)
        </div>
        <div class="col-sm-9 col-lg-2" style="border-right:1px solid #E1E1E1;">
            @Html.DisplayFor(model => model.PlannedPeopleCount)
        </div>
        <div class="col-sm-3 col-lg-2 mb-4">
            @Html.DisplayNameFor(model => model.PeopleCount)
        </div>
        <div class="col-sm-9 col-lg-1">
            @if (Model.PeopleCount == 0)
            {
                <span>-</span>
            }
            else
            {
                @Html.DisplayFor(model => model.PeopleCount)
            }
        </div>
        <div><hr /></div>
        @*Additional requirements container*@
        <div>
            <div class="d-flex mt-4 mb-2 justify-content-between">
                <h3 class="my-4 fw-bold">Specifiniai reikalavimai</h3>
                <a asp-controller="Requirements" asp-route-eventId="@Model.Id" asp-action="Create" class="btn btn-primary my-3 col-3 rounded-2">
                    <i class="fas fa-plus-circle pt-1 pe-1" style="font-size: 20px"></i>
                    Sukurti specifinį reikalavimą
                </a>
            </div>
            @if (Model.Requirements.Count != 0)
            {
                @foreach (var requirement in Model.Requirements)
                {
                    <div class="card mb-4 w-75">
                        <div class="card-header d-flex justify-content-between">
                            <div class="fw-bold">@requirement.Name</div>
                            @if (requirement.User != null)
                            {
                                <div>
                                    <span class="me-1 px-2 rounded-3 text-white fw-light bg-dark">@requirement.User.Name @requirement.User.Surname</span>
                                    @if(requirement.Is_fulfilled)
                                    {
                                         <span><i class="ms-2 fas fa-check text-success"></i></span>
                                    }
                                </div>
                            }
                        </div>
                        <div class="row m-3">
                            <div class="col-6">@requirement.Description</div>
                            <div class="col">
                                <a asp-controller="Requirements" asp-action="Edit" asp-route-id="@requirement.Id"
                                    class="btn btn-outline-secondary mx-3 rounded-2">
                                    <i class="fas fa-edit pe-1"></i> Redaguoti
                                </a>
                                <!-- Button trigger modal -->
                                <button type="button" class="btn btn-outline-danger rounded-2" data-toggle="modal" data-target="#exampleModal-@requirement.Id">
                                  <i class="fas fa-trash pe-1"></i> Ištrinti
                                </button>

                                <!-- Modal -->
                                <div class="modal fade" id="exampleModal-@requirement.Id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                  <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Ar tikrai norite pašalinti?</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                        </button>
                                      </div>
                                      <div class="modal-body">
                                        Pašalinsite specifinį reikalavimą: <b>@requirement.Name</b> iš renginio
                                      </div>
                                      <div class="modal-footer">
                                        @*<button type="button" class="btn btn-secondary" data-dismiss="modal">Uždaryti</button>*@
                                        <form asp-action="Delete">
                                            <input type="submit" asp-action="Delete" asp-route-id="@requirement.Id"  value="Patvirtinti" class="btn btn-danger rounded-3 text-uppercase" />
                                        </form>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <!----->

                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="alert bg-light w-50" role="alert">
                    Nėra sukurta specifinių reikalavimų šiam renginiui
                </div>
            }
            <hr />
        </div>
        @*Outlay*@
        <div>

        </div>
        <div>
            <div class="float-start">
                <a asp-action="Index" class="btn btn-outline-dark"><i class="fas fa-arrow-left"></i>  Grįžti į sąrašą</a>
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-secondary mx-3 rounded-2"><i class="fas fa-edit pe-1"></i> Redaguoti</a>
            </div>
            <div class="float-end">
                <!-- Button trigger modal -->
                <button type="button" class="btn btn-danger rounded-2" data-toggle="modal" data-target="#exampleModal-@Model.Id">
                    <i class="fas fa-trash pe-1"></i> Ištrinti
                </button>

                <!-- Modal -->
                <div class="modal fade" id="exampleModal-@Model.Id" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Ar tikrai norite pašalinti?</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        </div>
                        <div class="modal-body">
                            Pašalinsite renginį: <b>@Model.Title</b>. Pašalinus renginį, bus pašalinta: 
                            <ol class="mt-3">
                              <li>Renginio komanda</li>
                              <li>Parama, susijusi su šiuo renginiu</li>
                              <li>Specifiniai reikalavimai, susije su šiuo renginiu</li>
                            </ol>   
                        </div>
                        <div class="modal-footer">
                        @*<button type="button" class="btn btn-secondary" data-dismiss="modal">Uždaryti</button>*@
                        <form asp-action="Delete">
                            <input type="submit" asp-action="Delete" asp-route-id="@Model.Id"  value="Patvirtinti" class="btn btn-danger rounded-3 text-uppercase rounded-2" />
                        </form>
                        </div>
                    </div>
                    </div>
                </div>
                <!----->
            </div>
        </div>
    </div>
</div>

@section Scripts
{
<script>
    $('#containerAddUser').hide();

    $('#addUserBtn').click(function(){
        $('#containerAddUser').toggle("slow");
    });

</script>
}